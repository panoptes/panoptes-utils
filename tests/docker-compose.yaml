version: '3.7'
services:
  astrometry-index:
    image: panoptes-astrometry-index:latest
    build:
      context: ../
      dockerfile: docker/astrometry-volume.Dockerfile
    container_name: panoptes-astrometry-index
    volumes:
      - astrometry:/astrometry/data
  testing:
    image: panoptes-utils:testing
    build:
      context: ../
      dockerfile: tests/Dockerfile
    tty: true
    container_name: panoptes-utils-testing
    env_file:
      - ./env
    command: [ "tests/run-tests.sh" ]
    volumes:
      - "${PANLOG}:/var/panoptes/logs"
      - astrometry:/astrometry/data
    depends_on:
      - astrometry-index
volumes:
  astrometry:
